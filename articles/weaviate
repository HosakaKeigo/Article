---
title: ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ Weaviateå…¥é–€ ã€œã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã¾ã§ã€œï¼ˆTypeScriptç‰ˆï¼‰
tags: LLM TypeScript Database ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ OpenAI
author: hosaka_
slide: false
---
## ã¯ã˜ã‚ã«
ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€è§¦ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ

GPTã‚’ç­†é ­ã¨ã™ã‚‹LLMã®æµ¸é€ã¨ã¨ã‚‚ã«ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä¸–ç•Œã§å­˜åœ¨æ„Ÿã‚’å¢—ã—ã¦ã„ã‚‹ã®ãŒã€ã€Œ**ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**ã€ã€‚AIã®æ ¹å¹¹ã«ã‚ã‚‹**åŸ‹ã‚è¾¼ã¿ï¼ˆEmbedding)** ã«ã‚ˆã£ã¦ç”Ÿæˆã—ãŸãƒ™ã‚¯ãƒˆãƒ«å€¤ã‚’æ‰±ã†ã®ã«ç‰¹åŒ–ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚

Googleãƒˆãƒ¬ãƒ³ãƒ‰ã§"vector database"ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€Chat GPTã‚’è¿½ã†ã‚ˆã†ã«ã‚¹ãƒ‘ã‚¤ã‚¯ã—ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2722903/8d85809f-5dbf-7db4-efbc-314814d549bd.png)
å‡ºå…¸ï¼š[Googleãƒˆãƒ¬ãƒ³ãƒ‰](https://trends.google.co.jp/trends/)

ç§ã‚‚OpenAIã®Embeddings APIã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã¦ä¿å­˜ã—ãŸã‚Šã€LangChainã®[Vectorstore Agent](https://python.langchain.com/docs/modules/agents/toolkits/vectorstore)ã§ãŠå•ã„åˆã‚ã›botã‚’ä½œã£ã¦ã¿ãŸã‚Šã€è‡ªå‰ã§ä½œã£ãŸ[ChatGPT Retrieval Plugin](https://github.com/openai/chatgpt-retrieval-plugin)ã¨æ¥ç¶šã•ã›ã¦ã¿ãŸã‚Šã¨ã€Chat GPTã‚’ãã£ã‹ã‘ã«ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§éŠã¶ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ã“ã‚Œã¾ã§ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦[Pinecone](https://www.pinecone.io/)ã‚’ä½¿ã£ã¦ã„ã¾ã—ãŸãŒã€ãã‚ãã‚æ–°ã—ã„ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚‚è§¦ã‚Œã¦ã¿ã‚ˆã†ã¨æ€ã„ç«‹ã¡ã€[Weaviate](https://weaviate.io/)ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚

https://weaviate.io/

æœ¬è¨˜äº‹ã¯ãã®è¨˜éŒ²ã§ã™ã€‚åŒã˜ãæ–°ã—ã„ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è§¦ã£ã¦ã¿ã‚ˆã†ã¨æ€ã£ã¦ã„ã‚‹æ–¹ã®å‚è€ƒã«ãªã‚Œã°ã¨ã€Weaviateã®å°å…¥ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥ã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒˆæ¤œç´¢ã™ã‚‹ã¾ã§ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## æœ¬è¨˜äº‹ã®è¦æ—¨
### Weaviateã®å°å…¥
- è©¦ã—ã¦ã¿ã‚‹ãªã‚‰ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ‰ç‰ˆWeaviateã®ç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼ˆsandbox)ãŒç°¡å˜ã€‚
- æ¥ç¶šã¯URLã¨APIã‚­ãƒ¼ã€‚

### ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šè¾¼ã¿
- Weaviateã¯ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å®šã‚ãŸSchemaã‹ã‚‰ä½œæˆã™ã‚‹**Class**ã‚’æŒã¤ã€‚
- ãƒ‡ãƒ¼ã‚¿ã¯JSONå½¢å¼ã§ç”¨æ„ã€‚äº‹å‰ã«ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã™ã‚‹å¿…è¦ã¯ãªãã€**Vectorizer**ã¨ã„ã†å†…éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã¦å–ã‚Šè¾¼ã‚ã‚‹ã€‚

### ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢
- Weaviateã«ãŠã‘ã‚‹ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã¨ã¯ã€Sparse/Denseï¼ˆç²—å¯†ï¼‰ã€2ã¤ã®ãƒ™ã‚¯ãƒˆãƒ«ã‚’çµ„ã¿åˆã‚ã›ã¦æ¤œç´¢ã™ã‚‹ã“ã¨ã€‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã¨ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ï¼ˆæ„å‘³æ¤œç´¢ï¼‰ã®æ›ã‘åˆã‚ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
- ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯ã€ã‚¯ã‚¨ãƒªã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åŠ ãˆã‚‹ã ã‘ã€‚äº‹å‰ã«ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã™ã‚‹å¿…è¦ã¯ãªã„ã€‚
  - TypeScriptã®Clientãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯GraphQLã‚¯ã‚¨ãƒªã«`withHybrid`ã‚’è¿½åŠ ã™ã‚‹ã€‚
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®`alpha`ã‚’èª¿æ•´ã™ã‚‹ã“ã¨ã§ã€ Sparse/Denseã®é‡ã¿ã¥ã‘ãŒã§ãã‚‹ã€‚

## ç’°å¢ƒãƒ»å¿…è¦ãªã‚‚ã®
- Node.js
  - v18.16.1
- TypeScript
  - [å…¬å¼ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª](https://github.com/weaviate/typescript-client)ã‚’ä½¿ç”¨ã€‚ 
- [Weaviate Cloud Servicesï¼ˆWCSï¼‰](https://weaviate.io/developers/wcs)
  - Weaviateã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ‰ç‰ˆ
  - ç„¡æ–™ã®*sandboxes*ã‚’ä½¿ç”¨
  - ãƒ‡ãƒ¼ã‚¿ã®ä¿æŒæœŸé–“ã¯14æ—¥
- OpenAI API
  - APIã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## Weaviateã«ã¤ã„ã¦
Weaviateã‚’ä¿¯ç°ã™ã‚‹æ—¥æœ¬èªã®æƒ…å ±ã¨ã—ã¦ã€å…ˆè¡Œè¨˜äº‹ãŒäºŒã¤ã‚ã‚Šã¾ã™ã€‚ï¼ˆPythonã€ãƒ­ãƒ¼ã‚«ãƒ«ï¼‰æœ¬è¨˜äº‹ã‚‚ã“ã‚Œã‚‰ã«è² ã£ã¦ï¼ˆè¿½ã£ã¦ï¼‰ã„ã‚‹ç‚¹ã€æœ€åˆã«ãŠã“ã¨ã‚ã‚Šã—ã¦ãŠãã¾ã™ã€‚

- [ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹Weaviateã®æ¦‚å¿µã‚’æ•´ç†ã™ã‚‹](https://dev.classmethod.jp/articles/weaviate-overview/)
- [ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹Weaviateã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è©¦ã—ã¦ã¿ã‚‹](https://dev.classmethod.jp/articles/try-weaviate-modules/)

Weaviateã®æ¦‚è¦³ã¯ã€å±‹ä¸Šå±‹ã‚’æ¶ã—ã¦ã‚‚è©®ãªã„ã®ã§ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®**Weaviate in a nutshell**ã®æ„è¨³ã‚’ä¸Šè¨˜è¨˜äº‹ã‹ã‚‰å¼•ç”¨ã—ã¾ã™ã€‚

https://weaviate.io/developers/weaviate

>- ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã™ã€‚
>- ãƒ‡ãƒ¼ã‚¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ™ã‚¯ã‚¿ãƒ¼ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ã™ã‚‹ã“ã¨ã§ã€ãã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãªç‰¹æ€§ã«åŸºã¥ã„ã¦ä¿å­˜ãƒ»å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
>- ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ï¼ˆç´”ç²‹ãªãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ã¨ã—ã¦ã‚‚ä½¿ãˆã¾ã™ã—ã€ã‚³ã‚¢æ©Ÿèƒ½ã‚’æ‹¡å¼µã™ã‚‹æ§˜ã€…ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ä¸€ç·’ã«ä½¿ã†ã“ã¨ã§ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚’ä»£æ›¿ã—ãŸã‚Šã§ãã¾ã™ã€‚
>- GraphQL APIãŒã‚ã‚Šã€ãƒ‡ãƒ¼ã‚¿ã«ç°¡å˜ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
>- é«˜é€Ÿã§ã™ï¼ˆã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼‰ 

ï¼ˆå¼•ç”¨å…ƒï¼š[ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹Weaviateã®æ¦‚å¿µã‚’æ•´ç†ã™ã‚‹](https://dev.classmethod.jp/articles/weaviate-overview/)ï¼‰

Weaviateã¯[LangChainã¨ã®æ¥ç¶š](https://python.langchain.com/docs/modules/data_connection/vectorstores/integrations/weaviate)ãŒç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€[ChatGPT Retrieval Plugin](https://github.com/openai/chatgpt-retrieval-plugin/tree/main/datastore/providers)ã§ã‚‚ã€Pineconeã®æ¬¡ã«æŒ™ã’ã‚‰ã‚Œã¦ãŠã‚Šã€ã‹ãªã‚Šä¸»æµã®ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨è¨€ãˆãã†ã§ã™ã€‚

ChatGPT Retrieval Pluginã®READMEã§ã¯æ¬¡ã®ã‚ˆã†ã«ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

>Weaviateã¯ã€è†¨å¤§ãªãƒ‡ãƒ¼ã‚¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ã™ã‚‹ãŸã‚ã«è¨­è¨ˆã•ã‚ŒãŸã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã‚’åˆã‚ã‹ã‚‰ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚Šã€åŠ¹ç‡çš„ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ãŒå¿…è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é©ã—ã¦ã„ã¾ã™ã€‚Weaviateã¯ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚‚ã—ãã¯ãƒãƒãƒ¼ã‚¸ãƒ‰ã®ã©ã¡ã‚‰ã§ã‚‚å¯èƒ½ã§ã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã«ãŠã‘ã‚‹æŸ”è»Ÿæ€§ã‚’æä¾›ã—ã¾ã™ã€‚

ï¼ˆå¼•ç”¨å…ƒï¼šhttps://github.com/openai/chatgpt-retrieval-plugin/tree/main#choosing-a-vector-database ï¼‰

ã“ã“ã§è§¦ã‚Œã‚‰ã‚Œã¦ã„ã‚‹ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ãŒæˆ‘ã€…ã®ç›®æ¨™ã§ã™ã€‚

### Weaviate Cloud Servicesï¼ˆWCSï¼‰
ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®Weaviateã¯ã€Dockerãªã©ã§ãƒ­ãƒ¼ã‚«ãƒ«ã«ç«‹ã¦ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€SaaSã¨ã—ã¦**Weaviate Cloud Services**ã‚‚æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://weaviate.io/developers/wcs

æœ¬è¨˜äº‹ã§ã¯Weaviate Cloud Servicesã®ç„¡æ–™ç‰ˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª
ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯åŸ·ç­†æ™‚ç‚¹ã§ä»¥ä¸‹ã®è¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

- Python
- TypeScript/JavaScript
  - TypeScriptã¸ã®ç§»è¡ŒãŒæ¨å¥¨ã€‚ 
- Go
- Java

https://weaviate.io/developers/weaviate/client-libraries

æœ¬è¨˜äº‹ã§ã¯TypeScriptãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ï¼ˆHybrid Search)ã«ã¤ã„ã¦
ã€Œãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã€ã‚’æ–‡å­—é€šã‚Šå–ã‚Œã°ã€ã€Œã€‡ã€‡æ¤œç´¢ã€ã¨ã€ŒÃ—Ã—æ¤œç´¢ã€ã®æ›ã‘åˆã‚ã›æ¤œç´¢ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€Weaviateã§ã¯ã€ŒSparse Vectorã€ï¼ˆç²—ãªãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã¨ã€ŒDense Vectorã€ï¼ˆå¯†ãªãƒ™ã‚¯ãƒˆãƒ«ï¼‰ãã‚Œãã‚Œã‚’ç”¨ã„ãŸæ¤œç´¢ã®æ›ã‘åˆã‚ã›ã‚’ã€Œãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã€ã¨è¨€ã£ã¦ã„ã¾ã™ã€‚

çµæœã¨ã—ã¦ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã¨ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã®ä¸¡æ–¹ã®ç‰¹æ€§ã‚’å‚™ãˆãŸæ¤œç´¢ãŒã§ãã¾ã™ã€‚

### Sparse Vector
BM25ã€SPLADEã¨ã„ã£ãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã•ã‚Œã‚‹ã€‚Weaviateã¯**BM25/BM25F**ã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚[^1]
å˜èªãƒ¬ãƒ™ãƒ«ã§é¡ä¼¼åº¦ï¼ˆScoreï¼‰ã‚’å‡ºã™ã€ã¤ã¾ã‚Šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã«é©ã—ã¦ã„ã‚‹ã€‚

[^1]:BM25ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®è¨˜äº‹ãŒéå°‚é–€å®¶ã«ã¯ã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã§ã™ã€‚https://dev.classmethod.jp/articles/mrmo-ml-20200422/

### Dense Vector
GloVe[^2]ã€Transformersã¨ã„ã£ãŸæ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã§ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã•ã‚Œã‚‹ã€‚ï¼ˆTransformersã¯GPTã®Tã§ã™ã­ã€‚ï¼‰
æ–‡è„ˆï¼ˆã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆï¼‰ã‚’è¸ã¾ãˆãŸã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã«é©ã—ã¦ã„ã‚‹ã€‚

[^2]:Global Vectors for Word Representation

Weaviateã¯æœ€åˆã‹ã‚‰ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãŸã‚ã‘ã§ã¯ãªãã€2022å¹´12æœˆã®v1.17ã§å°å…¥ã•ã‚Œã¾ã—ãŸã€‚

https://github.com/weaviate/weaviate/releases/tag/v1.17.0

--- 
ã¡ãªã¿ã«Pineconeã‚‚ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã¨å¾“æ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã®æ›ã‘åˆã‚ã›ã‚‹ã€Œãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã€ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

https://www.pinecone.io/learn/hybrid-search-intro/

Pineconeã§ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã®å®Ÿè£…ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã€‚

https://dev.classmethod.jp/articles/pinecone-overview/#toc-8

https://qiita.com/orc_jj/items/4f631a772372dbb41644

## Weaviate Cloud Servicesï¼ˆWCSï¼‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
æ¦‚å¿µã¯ã“ã®ãã‚‰ã„ã«ã—ã¦ã€Weaviateã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«ã‚ãŸã£ã¦ã¯ã€ä¸‹è¨˜ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

https://weaviate.io/developers/weaviate/quickstart

### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯ç°¡å˜ã§ã€[ã“ã¡ã‚‰](https://weaviate.io/)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã€ŒStart Freeã€ã‚’æŠ¼ä¸‹ã€‚
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2722903/4043110c-c937-4b07-e07e-0489548a1dfe.png)

Weaviate Consoleã§*Don't have an account? Register here*ã‚’é¸æŠã—ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç™»éŒ²ã€‚
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2722903/54dfc5ee-58cf-baae-d9ab-c97fb852e702.png)

ãƒ¡ãƒ¼ãƒ«ãŒé£›ã³ã¾ã™ã®ã§ã€ãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã‚’è¸ã‚“ã§ã„ãã€Verificationã‚’æ¸ˆã¾ã›ã‚Œã°ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²å®Œäº†ã§ã™ã€‚
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2722903/9823ed53-0eaa-1cc8-a70f-6eeef469b970.png)

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆClusterï¼‰ä½œæˆ
*Create cluster*ã‚’é¸æŠã€‚
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2722903/02142536-c51d-f0f6-680f-b0a80766baf3.png)

Free sandboxã«ã—ã¦ã€*Create*ã‚’æŠ¼ä¸‹ã—ã¦ã€ä½œæˆå®Œäº†ã§ã™ã€‚ä½œæˆå®Œäº†ã¾ã§30ç§’ã»ã©ãŒã‹ã‹ã‚Šã¾ã™ã€‚
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2722903/9092e98f-284d-1e6d-dbe0-b61c4900353b.png)

### èªè¨¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹
Detailsã‚’é–‹ãã¾ã™ã€‚
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2722903/8cd2fdf6-dcf3-341c-e6ca-37c31ab59524.png)

- Cluster URLã‚’å–å¾—
  - https://your-cluster-name.weaviate.network ã®å½¢å¼ 
- *Authentication*ã®æ¬„ãŒå±•é–‹ã•ã‚Œã‚‹ã®ã§ã€å³ã®éµãƒãƒ¼ã‚¯ã‹ã‚‰APIã‚­ãƒ¼ã‚’å–å¾—
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2722903/cc6fd82b-29bd-8d59-4d47-e6408239117f.png)

ã“ã‚Œã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ã§ã™ã€‚

## å®Ÿè£…
Officialã®[typescript-client](https://github.com/weaviate/typescript-client)ã‚’ä½¿ã£ã¦ã€ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿ã‹ã‚‰ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã¾ã§ã€[Quickstart Tutorial](https://weaviate.io/developers/weaviate/quickstart)ã«å¾“ã£ã¦å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

ä½œæ›²å®¶ã¨æ›²åæƒ…å ±ã‚’æŒã¤JSONé…åˆ—ã‚’å–ã‚Šè¾¼ã¿ã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã‚’è¡Œã†ã“ã¨ã‚’ç›®æ¨™ã¨ã—ã¾ã™ã€‚

### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
ä»Šå›ç”¨ã„ã‚‹ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©ã¯ã“ã¡ã‚‰ã€‚

```ts:ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©
interface Music {
  "piece_id": string,
  "composer": string,
  "pieceName": string,
}
```

**JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¾‹**
```json
{
  "piece_id": 206,
  "composer": "ãƒ–ãƒ©ãƒ¼ãƒ ã‚¹",
  "pieceName": "ãƒ”ã‚¢ãƒå”å¥æ›²ã€€ç¬¬1ç•ª",
}
```

ä»¥ä¸Šã®å½¢å¼ã§ã€ã‚·ãƒ§ãƒ‘ãƒ³ã¨ãƒ–ãƒ©ãƒ¼ãƒ ã‚¹ã®æ›²ã‚’250æ›²åˆ†ã‚’æ‰±ã£ã¦ã¿ã¾ã™ã€‚

:::note
æœ€çµ‚çš„ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãªã‚Šã¾ã™ã€‚

ğŸ“¦weaviate_hybrid_search
 â”£ ğŸ“‚node_modules
 â”£ ğŸ“œconfig.ts
 â”£ ğŸ“œcreateClass.ts
 â”£ ğŸ“œformatJSON.ts
 â”£ ğŸ“œformatted_data.json
 â”£ ğŸ“œhybridSearch.ts
 â”£ ğŸ“œimportData.ts
 â”£ ğŸ“œpackage-lock.json
 â”£ ğŸ“œpackage.json
 â”— ğŸ“œsample.json

:::

### 0. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
ã¯ã˜ã‚ã«Node.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```sh
mkdir weaviate_hybrid_search
cd weaviate_hybrid_search
npm init -y
```

ç¶šã„ã¦TypeScriptã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œç”¨ã®ts-nodeã‚’å°å…¥ã—ã¾ã™ã€‚

```sh
npm install --save-dev typescript ts-node
npm install weaviate-ts-client
```
ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèªã®ãŸã‚ã€`package.json`ã‚’æ²è¼‰ã—ã¾ã™ã€‚

```json:package.json
{
  "name": "weaviate_hybrid_search",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "weaviate-ts-client": "^1.4.0"
  },
  "devDependencies": {
    "ts-node": "^10.9.1",
    "typescript": "^5.1.6"
  }
}
```

### 1. Weaviateã®æ¥ç¶šæƒ…å ±ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
ã¾ãšã€`config.ts`ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ä½œæˆã—ã€Weaviateã®æ¥ç¶šæƒ…å ±ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

ãªãŠã€ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿ã®éš›ã®**Vevtorizer**ã§OpenAI Embedding APIã‚’ç”¨ã„ã‚‹ãŸã‚ã€**OpenAI-Api-Key**ãŒå¿…è¦ã§ã™ã€‚ï¼ˆå–å¾—æ–¹æ³•ã«ã¤ã„ã¦æœ¬è¨˜äº‹ã§ã¯è§¦ã‚Œã¾ã›ã‚“ã€‚ï¼‰

```ts:config.ts
import { ApiKey } from 'weaviate-ts-client';

const weaviateClientArg = {
  scheme: 'https',
  host: '<ClusterName>.weaviate.network',  // å‰é …ã§å–å¾—ã—ãŸCluster URL
  apiKey: new ApiKey('XXXXXXXXXXXXXXXXXXXX'),  // å‰é …ã§å–å¾—ã—ãŸWeaviateã®API KEY
  headers: { 'X-OpenAI-Api-Key': 'sk-XXXXXXXXXXXXXXXXXXX' },  // OpenAIã®API KEY
}

export { weaviateClientArg }
```

### 2. Schemaã‹ã‚‰Classã‚’ä½œæˆã™ã‚‹
ç¶šã„ã¦ã€**Class**ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚`createClass.ts`ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«è¿½åŠ ã—ã¾ã™ã€‚

```ts:createClass.ts
import weaviate, { WeaviateClient } from "weaviate-ts-client";
import { weaviateClientArg } from "./config";

async function createClass() {
  const client: WeaviateClient = weaviate.client(weaviateClientArg);

  const classObj = {
    "class": "Music",
    "vectorizer": "text2vec-openai",
    "description": "Information about classical piano music.",
    "properties": [
      {
        "dataType": ["text"],
        "name": "composer",
        "description": "The composer",
        "moduleConfig": {
          "text2vec-openai": {
            "model": "ada",
            "modelVersion": "002",
            "type": "text",
            "skip": false
          }
        },
      },
      {
        "dataType": ["text"],
        "name": "pieceName",
        "description": "The name of piece",
        "moduleConfig": {
          "text2vec-openai": {
            "model": "ada",
            "modelVersion": "002",
            "type": "text",
            "skip": false
          }
        },
      },
      {
        "dataType": ["int"],
        "name": "piece_id",
        "description": "The id of the piece",
        "moduleConfig": {
          "text2vec-openai": {
            "model": "ada",
            "modelVersion": "002",
            "type": "text",
            "skip": true
          }
        },
      }
    ]
  }

  const res = await client.schema.classCreator().withClass(classObj).do();
  console.log(res);
}

createClass()
```

ç‰¹å®šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã®å¯¾è±¡å¤–ã«ã—ãŸã„å ´åˆã¯ã€`moduleConfig`å†…ã§`skip`ã‚’trueã«ã—ã¾ã™ã€‚

`dataType`ã®ä¸€è¦§ã¯ä¸‹è¨˜ã«ã‚ã‚Šã¾ã™ã€‚

https://weaviate.io/developers/weaviate/config-refs/datatypes

ts-nodeã§å®Ÿè¡Œã—ã¾ã™ã€‚
```sh
ts-node createClass.ts
```

:::note
Classã‚’ä½œæˆã—ç›´ã—ãŸã„å ´åˆãªã©ã®ãŸã‚ã€å‰Šé™¤ç”¨ã®é–¢æ•°ã‚‚è²¼ã£ã¦ãŠãã¾ã™ã€‚
Classåã‚’æŒ‡å®šã—ã¦ã€ts-nodeã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

<details>
<summary>Classã®å‰Šé™¤</summary>

```ts:deleteClass
import weaviate, { WeaviateClient } from 'weaviate-ts-client';
import { weaviateClientArg } from './config';

/**
 * Classã®å‰Šé™¤
 * @param className
 */
async function deleteClass(className: string) {
  const client: WeaviateClient = weaviate.client(weaviateClientArg);

  client.schema
    .classDeleter()
    .withClassName(className)
    .do()
    .then((res: any) => {
      console.log(res);
    })
    .catch((err: Error) => {
      console.error(err)
    });
}

deleteClass("Music")
```

</details>

:::

### 3. JSONãƒ‡ãƒ¼ã‚¿ã®ç”¨æ„
#### JSONãƒ‡ãƒ¼ã‚¿ã«uuidã‚’è¿½åŠ ã™ã‚‹
Weaviateã¯å–ã‚Šè¾¼ã¿æ™‚ã«uuidã‚’æŒ¯ã£ã¦ãã‚Œã¾ã™ãŒã€ä»Šå›ã¯uuidä»˜ãã®JSONãƒ‡ãƒ¼ã‚¿ã‚’äº‹å‰ã«ç”¨æ„ã—ã¾ã™ã€‚

```sh
npm install uuid
npm i --save-dev @types/uuid
```

ãƒ‡ãƒ¼ã‚¿ã¯`sample.json`ã®åå‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ç½®ãã¾ã™ã€‚

```ts:formatJSON.ts
// å–ã‚Šè¾¼ã‚€JSONã®å½¢å¼ã«ã—ã¦ãã ã•ã„ã€‚
interface Music {
  "piece_id": string,
  "composer": string,
  "pieceName": string,
}

import { v5 as uuidv5 } from 'uuid';
import fs from 'fs';
import path from 'path';

const NAMESPACE = 'fccc1a21-0397-4ecb-abfe-de06761b3616'; // ä»»æ„ã®uuidï¼”ã‚’æŒ‡å®š

function addUUID(data: Array<Music>): Array<Music & { uuid: string }> {
  return data.map(item => ({
    ...item,
    uuid: uuidv5(`${item.composer}${item.pieceName}`, NAMESPACE)
  }));
}

async function formatData() {
  const rawData = await fs.promises.readFile(path.join(__dirname, './sample.json'), 'utf-8');
  const data = JSON.parse(rawData);

  const formattedData = addUUID(data);

  await fs.promises.writeFile(path.join(__dirname, './formatted_data.json'), JSON.stringify(formattedData, null, 2));

  console.log('Data has been formatted and written to ./formatted_data.json');
}

formatData()
```

ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh
ts-node formatJSON.ts
```

ã“ã‚Œã§uuidä»˜ãã®å–ã‚Šè¾¼ã¿ãƒ‡ãƒ¼ã‚¿ãŒå®Œæˆã§ã™ã€‚

```json:formatted_data.json
[
  {
    "piece_id": 206,
    "composer": "ãƒ–ãƒ©ãƒ¼ãƒ ã‚¹",
    "pieceName": "ãƒ”ã‚¢ãƒå”å¥æ›²ã€€ç¬¬1ç•ª",
    "uuid": "bce5c1ce-6e20-5226-a130-a9b991d62107"
  },
  {
    "piece_id": 207,
    "composer": "ãƒ–ãƒ©ãƒ¼ãƒ ã‚¹",
    "pieceName": "ãƒ”ã‚¢ãƒå”å¥æ›²ã€€ç¬¬2ç•ª",
    "uuid": "03f397b3-ce6b-5772-a177-2e2a8016c0c9"
  },...
]
```

:::note
`NAMESPACE`ã¯ä¸‹è¨˜ã®ãƒ„ãƒ¼ãƒ«ãªã©ã§ä½œæˆã—ãŸä»»æ„ã®uuidï¼ˆv4ï¼‰ã§ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
https://www.uuidgenerator.net/version4
:::

### 4. ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šè¾¼ã‚€
å‰é …ã§ä½œæˆã—ãŸ`formatted_data.json`ã‚’`Music`ã‚¯ãƒ©ã‚¹ã«å–ã‚Šè¾¼ã¿ã¾ã™ã€‚
ä¸‹è¨˜ã®`importData.ts`ã‚’æ–°ãŸã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«è¿½åŠ ã—ã¾ã™ã€‚

```ts:importtData
import weaviate, { WeaviateClient, ObjectsBatcher, WeaviateObject } from 'weaviate-ts-client';
import { weaviateClientArg } from './config';
import fs from 'fs';

async function importData() {
  const className = "Music" // ä½œæˆã—ãŸClassåã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
  const client: WeaviateClient = weaviate.client(weaviateClientArg);

  const musicJSON = JSON.parse(await fs.promises.readFile('formatted_data.json', 'utf8'))

  let batcher: ObjectsBatcher = client.batch.objectsBatcher();
  let counter = 0;
  let batchSize = 100;

  for (const item of musicJSON) {
    const obj: WeaviateObject = {
      class: className,
      id: item.uuid,
      properties: {
        piece_id: item.piece_id, // Classã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ç½®ãå¤‰ãˆã¦ãã ã•ã„ã€‚
        composer: item.composer,
        pieceName: item.pieceName,
      },
    }

    batcher = batcher.withObject(obj);

    if (counter++ == batchSize) {
      const res = await batcher.do();
      console.log(res);

      counter = 0;
      batcher = client.batch.objectsBatcher();
    }
  }

  const res = await batcher.do();
  console.log(res);
}

importData()
```
(å‚è€ƒï¼šhttps://weaviate.io/developers/weaviate/quickstart#add-objects)

```sh
ts-node importData.ts
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªJSONã®é…åˆ—ã«ãªã£ã¦ãŠã‚Šã€`result.status`ãŒ`SUCCESS`ã¨ãªã£ã¦ã„ã‚Œã°ã€å–ã‚Šè¾¼ã¿æˆåŠŸã§ã™ã€‚

<details>
<summary>ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ1é …ç›®åˆ†ã‚’æŠœç²‹ï¼‰</summary>

```sh
 {
    class: 'Music',
    creationTimeUnix: 1689176786417,
    id: 'fecb6795-b1d5-5303-9fb6-6740f30fb0e0',
    lastUpdateTimeUnix: 1689176786417,
    properties: {
      composer: 'ãƒ–ãƒ©ãƒ¼ãƒ ã‚¹',
      pieceName: 'ãƒ­ãƒ™ãƒ«ãƒˆãƒ»ã‚·ãƒ¥ãƒ¼ãƒãƒ³ã®äº”é‡å¥ã‚ˆã‚Šã‚¹ã‚±ãƒ«ãƒ„ã‚©',
      piece_id: 83446
    },
    vector: [
          -0.01618669,  -0.009350241,    -0.02352856,    -0.03952904,
       -0.00037532306,   0.040167466,   -0.018062059,   -0.010101719,
         -0.015840879, -0.0047582486,   -0.014431027,  -0.0021014768,
         -0.032133974,  0.0004933649,   -0.011770929,    0.006277829,
         0.0049477806,  0.0019202576,    0.030591115,   -0.016918218,
      -0.000040291117,  -0.012515756,  -0.0019684718,    0.010540634,
         -0.016785212,  0.0024988286,    0.017796049,   -0.029553678,
          0.009097532, -0.0026268458,      0.0493448,  -0.0026750602,
         -0.017210828,  0.0018753684,   -0.005296918,   -0.042614754,
         -0.015947282,  -0.011770929,   -0.014298022,  -0.0033134834,
         -0.013047776,   -0.00397352,    0.014869942,   0.0067499964,
         -0.027851216,  0.0035213034,   -0.005722534,  -0.0040200716,
          0.009303689,   0.010095068,    0.021533486,    0.017942354,
         -0.041976333,   0.005675982,    0.019272404, -0.00014786399,
          0.011850732,  0.0019235826, -0.00040836647,  -0.0101083685,
           0.00878497,   0.009090882,   -0.025310824,  0.00040109275,
         -0.011997038,  -0.011644575,    -0.02275713,   0.0068963016,
         -0.017702946, -0.0083992565,  -0.0009052643,     0.03697535,
         -0.017796049,  0.0137394015,    0.024512794,   -0.010906398,
          -0.02848964,  -0.015654672,    0.016732011,    0.006078322,
          0.020549249,  -0.012848269,  -0.0011854058,  0.00021800326,
          0.018487675,  -0.007760833,   -0.012302949,   0.0057391594,
           -0.0191793,   -0.02880885,   0.0024456268,   -0.007780784,
        -0.0016118526,  0.0006026782,  -0.0048380517,     0.01123891,
          0.006191376,   0.019418709,   -0.028862054,   -0.025443828,
      ... 1436 more items
    ],
    deprecations: null,
    result: { status: 'SUCCESS' }
  }
```
</details>

### 5. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã‚’è¡Œã†
ãƒ‡ãƒ¼ã‚¿ãŒå–ã‚Šè¾¼ã‚ãŸã®ã§ã€ã„ã‚ˆã„ã‚ˆæ¤œç´¢ã—ã¦ã¿ã¾ã™ã€‚
TypeScriptã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ã€`withHybrid`ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ãŒã§ãã¾ã™ã€‚

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®`alpha`ã¯0ã‹ã‚‰1ã¾ã§ã®å€¤ã‚’å–ã‚Šã€**0ã«è¿‘ã„ã»ã©ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã€1ã«è¿‘ã„ã»ã©ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ï¼ˆæ„å‘³æ¤œç´¢ï¼‰** ã«ãªã‚Šã¾ã™ã€‚

https://weaviate.io/developers/weaviate/search/hybrid

```ts:hybridSearch.ts
import weaviate, { WeaviateClient } from 'weaviate-ts-client';
import { weaviateClientArg } from './config';

async function hybridSearch({ query, alpha }: { query: string, alpha: number }) {
  const client: WeaviateClient = weaviate.client(weaviateClientArg);
  const className = "Music"

  const res = await client.graphql
    .get()
    .withClassName(className)
    .withFields('piece_id composer pieceName _additional { score explainScore }')
    .withHybrid({
      query,
      alpha
    })
    .withLimit(5)
    .do()

  console.log(JSON.stringify(res, null, 2));
  return res
}

const queryArg = {
  query: 'ï¼œè³ªå•å†…å®¹ï¼',
  alpha: 0.75 // é‡ã¿ã¥ã‘
}

hybridSearch(queryArg);
```

ãŸã¨ãˆã°ã€ä½œæ›²å®¶ã®é–“é•ã£ãŸ`ãƒ–ãƒ©ãƒ¼ãƒ ã‚¹ å¹»æƒ³å³èˆˆæ›²`ã¨ã„ã†ã‚¯ã‚¨ãƒªã§æ¤œè¨¼ã—ã¦ã¿ã¾ã—ãŸã€‚

ã“ã®æ™‚ã€ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœã¨ãªã‚Šã¾ã—ãŸã€‚

<table>
<tr>
<th>Alpha = 0.1 (ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é‡è¦–)</th>
<th>Alpha = 0.9 (ãƒ™ã‚¯ãƒˆãƒ«è¿‘ä¼¼é‡è¦–)</th>
</tr>
<tr>
<td>

| Composer | Piece Name |
|----------|------------|
| ã‚·ãƒ§ãƒ‘ãƒ³ | å¹»æƒ³å³èˆˆæ›² (éºä½œ) |
| ã‚·ãƒ§ãƒ‘ãƒ³ï¼ã‚°ãƒ¼ãƒ«ãƒ‰&ã‚·ã‚§ãƒ•ã‚¿ãƒ¼ | å¹»æƒ³å³èˆˆæ›²(2å°ãƒ”ã‚¢ãƒï¼‰ |
| ãƒ–ãƒ©ãƒ¼ãƒ ã‚¹ | ã‚¹ã‚±ãƒ«ãƒ„ã‚© |

</td>
<td>

| Composer | Piece Name |
|----------|------------|
| ãƒ–ãƒ©ãƒ¼ãƒ ã‚¹ | 7ã¤ã®å¹»æƒ³æ›²é›† |
| ãƒ–ãƒ©ãƒ¼ãƒ ã‚¹ | å‰µä½œä¸»é¡Œã«ã‚ˆã‚‹å¤‰å¥æ›² |
| ãƒ–ãƒ©ãƒ¼ãƒ ã‚¹ | ã‚·ãƒ¥ãƒ¼ãƒãƒ³ã®ä¸»é¡Œã«ã‚ˆã‚‹å¤‰å¥æ›² |

</td>
</tr>
</table>

ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã«æ¯”é‡ã‚’ç½®ãã¨ã€ã‚ˆã‚Šãƒ¬ã‚¢ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ã‚ã‚‹ã€Œå¹»æƒ³å³èˆˆæ›²ã€ã®ä¸€è‡´ãŒå„ªå…ˆã•ã‚Œã‚·ãƒ§ãƒ‘ãƒ³ã®æ¥½æ›²ãŒãƒ’ãƒƒãƒˆã—ã¾ã—ãŸã€‚

ä¸€æ–¹ã§alphaå€¤ã‚’ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã«å¯„ã›ã¦ã¿ã‚‹ã¨ã€ã‚ˆã‚Šå…¨ä½“ã®ä¸€è‡´ãŒå„ªå…ˆã•ã‚Œã€ãƒ–ãƒ©ãƒ¼ãƒ ã‚¹ã®ã€Œ7ã¤ã®å¹»æƒ³æ›²é›†ã€ãŒãƒ’ãƒƒãƒˆã™ã‚‹çµæœã¨ãªã‚Šã¾ã—ãŸã€‚

ä»Šå›ã¯ä½œæ›²å®¶ã€æ›²åã¨ã„ã†çŸ­ã„é …ç›®ã®ã¿ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¾ã—ãŸãŒã€æ–‡ç« æ¤œç´¢ã®å ´åˆã¯ã€é‡ã¿ã¥ã‘ã®å·®ãŒã‚ˆã‚Šé¡•è‘—ã«å‡ºã‚‹ã‚‚ã®ã¨æ€ã‚ã‚Œã¾ã™ã€‚

## ãŠã‚ã‚Šã«
ä»¥ä¸Šã€Weaviateã®å°å…¥ã‹ã‚‰ã€TypeScriptã§ã®ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿ã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã¾ã§ã‚’æ‰±ã„ã¾ã—ãŸã€‚

Weaviateã¯ã€ãã®ç‰¹å¾´ã§ã‚ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€**Vectorizer**ã«ã‚ˆã£ã¦ã€JSONãƒ‡ãƒ¼ã‚¿ã‚’äº‹å‰ã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–ãªã—ã«å–ã‚Šè¾¼ã‚ã‚‹ã®ãŒã€ã¨ã£ã¤ãã‚„ã™ãé­…åŠ›çš„ã§ã™ã€‚

ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã«é–¢ã—ã¦ã‚‚ã€Sparse/Denseã€äºŒã¤ã®Embeddingã‚’ä½œã‚‹å¿…è¦ãªãã€ãƒ¡ã‚½ãƒƒãƒ‰ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰ãˆã‚‹ã ã‘ã§ã‚ˆãã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã‚’ãŠæ‰‹è»½ã«è©¦ã—ã¦ã¿ã‚‹ã«ã¯ã€ã†ã£ã¦ã¤ã‘ã®ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚

Weaviateã€ãœã²è§¦ã£ã¦ã¿ã¦ãã ã•ã„ã€‚
